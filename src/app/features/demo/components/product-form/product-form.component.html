<div class="mx-auto max-w-3xl p-4">
  <!-- ═══════ TITLE: dynamic based on create/edit mode ═══════ -->
  <h1 class="mb-6 text-2xl font-bold dark:text-white">
    @if (isEditMode()) {
      <span i18n="@@demo.form.editTitle">Edit Product</span>
    } @else {
      <span i18n="@@demo.form.createTitle">Create Product</span>
    }
  </h1>

  <!-- ═══════ SKELETON: SkeletonFormComponent while edit data loads ═══════ -->
  @if (isEditMode() && editResource.isLoading()) {
    <app-skeleton-form [fields]="8" />
  } @else {
    <form (submit)="handleSubmit($event)" class="space-y-8" novalidate>

      <!-- ═══════ SECTION 1: Basic Information ═══════ -->
      <fieldset class="space-y-4 rounded border p-4 dark:border-gray-700">
        <legend class="px-2 font-semibold dark:text-gray-200" i18n="@@demo.form.basicLegend">Basic Information</legend>

        <!-- NAME — required + minLength(3) + maxLength(100) -->
        <app-input
          label="Name"
          i18n-label="@@demo.form.nameLabel"
          inputId="product-name"
          [field]="fieldTree.name"
          placeholder="Enter product name"
          i18n-placeholder="@@demo.form.namePlaceholder"
        />

        <!-- SKU — required + pattern(/^[A-Z]{3}-\d{5}$/) -->
        <app-input
          label="SKU"
          i18n-label="@@demo.form.skuLabel"
          inputId="product-sku"
          [field]="fieldTree.sku"
          placeholder="e.g. ELC-00123"
          i18n-placeholder="@@demo.form.skuPlaceholder"
          inputClass="font-mono"
        />

        <!-- CATEGORY — required + select dropdown — uses shared SelectComponent -->
        <app-select
          label="Category"
          i18n-label="@@demo.form.categoryLabel"
          inputId="product-category"
          [field]="fieldTree.category"
          [options]="categories"
          placeholder="Select a category"
          i18n-placeholder="@@demo.form.categoryDefault"
          dropdownArrow="custom"
        />
      </fieldset>

      <!-- ═══════ SECTION 2: Details ═══════ -->
      <fieldset class="space-y-4 rounded border p-4 dark:border-gray-700">
        <legend class="px-2 font-semibold dark:text-gray-200" i18n="@@demo.form.detailsLegend">Details</legend>

        <!-- DESCRIPTION — minLength(10) + maxLength(500) + debounce(500ms) -->
        <app-input
          label="Description"
          i18n-label="@@demo.form.descLabel"
          inputId="product-desc"
          [field]="fieldTree.description"
          [rows]="4"
          placeholder="Describe the product (min 10 chars)"
          i18n-placeholder="@@demo.form.descPlaceholder"
        >
          <span label-hint class="font-normal text-gray-400 dark:text-gray-500">(debounced — 500ms)</span>
        </app-input>

        <!-- CONTACT EMAIL — required + email() -->
        <app-input
          label="Contact Email"
          i18n-label="@@demo.form.emailLabel"
          inputId="product-email"
          type="email"
          [field]="fieldTree.contactEmail"
          placeholder="contact@example.com"
          i18n-placeholder="@@demo.form.emailPlaceholder"
        />
      </fieldset>

      <!-- ═══════ SECTION 3: Pricing & Inventory ═══════ -->
      <fieldset class="space-y-4 rounded border p-4 dark:border-gray-700">
        <legend class="px-2 font-semibold dark:text-gray-200" i18n="@@demo.form.pricingLegend">Pricing &amp; Inventory</legend>

        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <app-input
            label="Price ($)"
            i18n-label="@@demo.form.priceLabel"
            inputId="product-price"
            type="number"
            step="0.01"
            [field]="fieldTree.price"
            placeholder="0.00"
            spinButtons="custom"
          />

          <app-input
            label="Quantity"
            i18n-label="@@demo.form.qtyLabel"
            inputId="product-qty"
            type="number"
            [field]="fieldTree.quantity"
            placeholder="0"
            spinButtons="custom"
          />
        </div>

        <!-- DISCOUNT — disabled when price < 50, cross-field validation -->
        <app-input
          label="Discount ($)"
          i18n-label="@@demo.form.discountLabel"
          inputId="product-discount"
          type="number"
          step="0.01"
          [field]="fieldTree.discount"
          placeholder="0.00"
          spinButtons="none"
          inputClass="disabled:bg-gray-100 disabled:text-gray-500 dark:disabled:bg-gray-700 dark:disabled:text-gray-400"
        >
          <span label-hint class="font-normal text-gray-400 dark:text-gray-500">
            (disabled when price &lt; $50)
          </span>
          @if (fieldTree.discount().disabled()) {
            <p class="mt-1 text-xs text-amber-600 dark:text-amber-400" i18n="@@demo.form.discountDisabledMsg">
              Set price to $50 or more to enable this field.
            </p>
          }
        </app-input>

        <hr class="border-gray-200 dark:border-gray-700" />

        <!-- IS ACTIVE — checkbox — uses shared CheckboxComponent -->
        <app-checkbox
          label="Product is active"
          i18n-label="@@demo.form.activeLabel"
          inputId="product-active"
          [field]="fieldTree.isActive"
          description="toggles promo code field"
          i18n-description="@@demo.form.activeDesc"
        />

        <!-- PROMO CODE — hidden when isActive is false -->
        @if (!fieldTree.promoCode().hidden()) {
          <app-input
            label="Promo Code"
            i18n-label="@@demo.form.promoLabel"
            inputId="product-promo"
            [field]="fieldTree.promoCode"
            placeholder="e.g. SAVE20"
            i18n-placeholder="@@demo.form.promoPlaceholder"
          >
            <span label-hint class="font-normal text-gray-400 dark:text-gray-500">
              (visible only when active)
            </span>
          </app-input>
        }
      </fieldset>

      <!-- ═══════ SECTION 4: Read-only ID (edit mode only) ═══════ -->
      @if (isEditMode()) {
        <fieldset class="space-y-4 rounded border p-4 dark:border-gray-700">
          <legend class="px-2 font-semibold dark:text-gray-200" i18n="@@demo.form.metaLegend">Metadata</legend>

          <app-input
            label="Product ID"
            i18n-label="@@demo.form.idLabel"
            inputId="product-id"
            type="number"
            [field]="fieldTree.id"
            spinButtons="none"
            inputClass="bg-gray-50 text-gray-500 dark:bg-gray-800 dark:text-gray-400"
          >
            <span label-hint class="font-normal text-gray-400 dark:text-gray-500">(read-only)</span>
          </app-input>
        </fieldset>
      }

      <!-- ═══════ ACTIONS ═══════ -->
      <div class="flex gap-2">
        <app-btn type="submit" variant="primary" [loading]="submitLoading()" [showLoader]="true">
          <app-icon name="check" size="sm" />
          <span i18n="@@demo.form.save">Save Product</span>
        </app-btn>
        <app-btn variant="secondary" (click)="resetForm()">
          <span i18n="@@demo.form.reset">Reset</span>
        </app-btn>
        <app-btn variant="secondary" (click)="cancel()">
          <app-icon name="chevron-left" size="sm" />
          <span i18n="@@demo.form.cancel">Cancel</span>
        </app-btn>
      </div>
    </form>
  }
</div>
