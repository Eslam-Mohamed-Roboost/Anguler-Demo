<div class="bg-white rounded-[12px] h-[calc(100vh-4rem)] flex flex-col p-4">
  <!-- ═══════ Info Banner ═══════ -->
  <div class="flex items-center gap-2 rounded-full border border-blue-200 bg-[#F9FAFAB2] px-4 py-3 text-sm text-[#5B738B] mx-4 mt-4 md:mx-6 md:mt-6">
    <app-icon name="info" size="sm" />
    <span>
      Your Payouts are scheduled on the 1st of every month. Payments are completed within 3 business days from the scheduling date. Your Commission ( 2% ) for each trip.
    </span>
  </div>

  <!-- ═══════ Header ═══════ -->
  <header class="flex flex-col gap-3 px-4 pt-6 pb-4 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between sm:gap-4 md:px-6">
    <h1 class="text-xl font-bold text-gray-900 sm:text-2xl">Financial History</h1>

    <div class="flex flex-wrap items-center gap-2 sm:gap-3">
      <!-- Search -->
      <div class="w-full sm:w-64">
        <app-search-input
          placeholder="Search Financial Records"
          (searchChange)="onSearch($event)"
        />
      </div>

      <!-- Filter / Clear Sort button -->
      <button
        type="button"
        (click)="clearSort()"
        class="flex flex-1 items-center justify-center gap-1.5 rounded-lg border px-4 py-2 text-sm font-medium transition sm:flex-none"
        [class]="sortState().direction
          ? 'border-primary bg-primary/10 text-primary hover:bg-primary/20'
          : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'"
      >
        <app-icon name="filter" size="sm" />
        <span>{{ sortState().direction ? 'Clear Sort' : 'Filter' }}</span>
      </button>

      <!-- Export button -->
      <button
        type="button"
        class="flex flex-1 items-center justify-center gap-1.5 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50 sm:flex-none"
      >
        <app-icon name="download" size="sm" />
        <span>Export</span>
      </button>
    </div>
  </header>

  <!-- ═══════ Data Table ═══════ -->
  <div class="px-4 md:px-6 flex-1 overflow-auto">
    <!-- Custom table implementation -->
    <div class="w-full">
      <!-- Table Header -->
      <div class="grid grid-cols-12 gap-4 pb-3 border-b border-gray-200 text-xs font-medium text-gray-500">
        <div class="col-span-1">Trip ID</div>
        <div class="col-span-2">Driver</div>
        <div class="col-span-2">Guest</div>
        <div class="col-span-1">Room No.</div>
        <div class="col-span-2">Route</div>
        <div class="col-span-1">Duration</div>
        <div class="col-span-1">Start/End Date</div>
        <div class="col-span-1">Trip Profit</div>
        <div class="col-span-1">Commulative Profit</div>
      </div>

      <!-- Table Body -->
      <div class="divide-y divide-gray-100">
        @for (item of paginatedTrips(); track item.id) {
          @if (isAlert(item)) {
            <!-- Alert Row -->
            <div class="col-span-12 py-4">
              <div class="flex items-center gap-3 p-4 rounded-lg" 
                   [class]="item.type === 'scheduled' 
                     ? 'bg-yellow-50 border border-yellow-200' 
                     : 'bg-gray-50 border border-gray-200'">
                <app-icon 
                  [name]="item.type === 'scheduled' ? 'info' : 'check'" 
                  size="sm"
                  [class]="item.type === 'scheduled' ? 'text-yellow-600' : 'text-gray-600'" />
                <span class="text-sm" 
                      [class]="item.type === 'scheduled' ? 'text-yellow-800' : 'text-gray-700'">
                  {{ item.message }}
                </span>
              </div>
            </div>
          } @else if (isTrip(item)) {
            <!-- Trip Row -->
            <div class="grid grid-cols-12 gap-4 py-3 items-center text-xs">
              <div class="col-span-1 font-medium">{{ item.tripId }}</div>
              <div class="col-span-2">
                <div class="flex items-center gap-2">
                  <span class="flex size-6 items-center justify-center rounded-full bg-gray-200 text-gray-500">
                    <app-icon name="user" size="xs" />
                  </span>
                  <span class="text-gray-700">{{ item.driver }}</span>
                </div>
              </div>
              <div class="col-span-2">{{ item.guestName }}</div>
              <div class="col-span-1">{{ item.roomNo }}</div>
              <div class="col-span-2">
                <div class="flex flex-col gap-1">
                  <span class="flex items-center gap-1">
                    <span class="inline-block size-2 rounded-full border-2 border-green-500 bg-green-500"></span>
                    {{ item.routeFrom }}
                  </span>
                  <span class="flex items-center gap-1">
                    <span class="inline-block size-2 rounded-full border-2 border-red-500 bg-red-500"></span>
                    {{ item.routeTo }}
                  </span>
                </div>
              </div>
              <div class="col-span-1">
                <div class="flex flex-col text-gray-600">
                  <span class="flex items-center gap-1">
                    <svg class="size-3 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    {{ item.durationMin }} min
                  </span>
                  <span class="text-gray-400 pl-[14px]">{{ item.distanceKm }} km</span>
                </div>
              </div>
              <div class="col-span-1">
                <div class="flex flex-col text-gray-600">
                  <span>{{ item.startDate }}</span>
                  <span class="text-gray-400">{{ item.endDate }}</span>
                </div>
              </div>
              <div class="col-span-1">
                <span class="font-semibold text-gray-800">$ {{ item.tripProfit.toFixed(2) }}</span>
              </div>
              <div class="col-span-1">
                <span class="font-semibold text-green-600">$ {{ item.CommulativeProfit.toFixed(2) }}</span>
              </div>
            </div>
          }
        }
      </div>
    </div>
  </div>

  <!-- ═══════ Pagination ═══════ -->
  <div class="px-4 pb-4 md:px-6 md:pb-6 flex-shrink-0">
    <!-- Debug info -->
    <div class="text-xs text-gray-500 mb-2">
      Total: {{ filteredTrips().length }}, Page Size: {{ pageSize() }}, Current: {{ currentPage() }}
    </div>
    <app-pagination
      [currentPage]="currentPage()"
      [totalItems]="filteredTrips().length"
      [pageSize]="pageSize()"
      (pageChange)="currentPage.set($event)"
    />
  </div>
</div>