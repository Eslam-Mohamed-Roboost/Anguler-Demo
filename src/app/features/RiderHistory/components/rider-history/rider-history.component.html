<div class="rider-history-page">
  <!-- ═══════ Info Banner ═══════ -->
  <div class="flex items-center gap-2 rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-800 mx-4 mt-4 md:mx-6 md:mt-6">
    <app-icon name="info" size="sm" />
    <span>
      Your Payouts are scheduled on the 1st of every month. Payments are completed within 3 business days from the scheduling date. Your Commission ( 2% ) for each trip.
    </span>
  </div>

  <!-- ═══════ Header ═══════ -->
  <header class="flex flex-col gap-3 px-4 pt-6 pb-4 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between sm:gap-4 md:px-6">
    <h1 class="text-xl font-bold text-gray-900 sm:text-2xl">Trips History</h1>

    <div class="flex flex-wrap items-center gap-2 sm:gap-3">
      <!-- Search -->
      <div class="w-full sm:w-64">
        <app-search-input
          placeholder="Search Trips"
          (searchChange)="onSearch($event)"
        />
      </div>

      <!-- Filter / Clear Sort button -->
      <button
        type="button"
        (click)="clearSort()"
        class="flex flex-1 items-center justify-center gap-1.5 rounded-lg border px-4 py-2 text-sm font-medium transition sm:flex-none"
        [class]="sortState().direction
          ? 'border-primary bg-primary/10 text-primary hover:bg-primary/20'
          : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'"
      >
        <app-icon name="filter" size="sm" />
        <span>{{ sortState().direction ? 'Clear Sort' : 'Filter' }}</span>
      </button>

      <!-- Export button -->
      <button
        type="button"
        class="flex flex-1 items-center justify-center gap-1.5 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50 sm:flex-none"
      >
        <app-icon name="upload" size="sm" />
        <span>Export</span>
      </button>
    </div>
  </header>

  <!-- ═══════ Data Table ═══════ -->
  <div class="px-4 md:px-6">
    <app-data-table
      [data]="paginatedTrips()"
      [columns]="columns"
      trackByKey="id"
      ariaLabel="Trips history table"
      (sortChange)="onSort($event)"
    >
      <!-- Custom cell: Driver with avatar -->
      <ng-template cellDef="driver" let-row>
        <div class="flex items-center gap-2">
          <span class="flex size-7 items-center justify-center rounded-full bg-gray-200 text-gray-500">
            <app-icon name="user" size="xs" />
          </span>
          <span class="text-sm text-gray-700">{{ row.driver }}</span>
        </div>
      </ng-template>

      <!-- Custom cell: Route (two lines with colored dots) -->
      <ng-template cellDef="route" let-row>
        <div class="flex flex-col gap-1 text-xs">
          <span class="flex items-center gap-1.5">
            <span class="inline-block size-2.5 rounded-full border-2 border-green-500 bg-green-500"></span>
            {{ row.routeFrom }}
          </span>
          <span class="flex items-center gap-1.5">
            <span class="inline-block size-2.5 rounded-full border-2 border-red-500 bg-red-500"></span>
            {{ row.routeTo }}
          </span>
        </div>
      </ng-template>

      <!-- Custom cell: Status badge -->
      <ng-template cellDef="status" let-row>
        <app-badge [variant]="getStatusVariant(row.status)">
          {{ row.status }}
        </app-badge>
      </ng-template>

      <!-- Custom cell: Duration -->
      <ng-template cellDef="duration" let-row>
        <div class="flex flex-col text-xs text-gray-600">
          <span class="flex items-center gap-1">
            <svg class="size-3.5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            {{ row.durationMin }} min
          </span>
          <span class="text-gray-400 pl-[18px]">{{ row.distanceKm }} km</span>
        </div>
      </ng-template>

      <!-- Custom cell: Fare -->
      <ng-template cellDef="fare" let-row>
        <div class="flex flex-col text-xs">
          <span class="font-semibold text-gray-800">$ {{ row.fare.toFixed(2) }}</span>
          <span class="text-gray-400">Comm. : ${{ row.commission.toFixed(2) }}</span>
        </div>
      </ng-template>

      <!-- Custom cell: Start/End Date -->
      <ng-template cellDef="startEndDate" let-row>
        <div class="flex flex-col text-xs text-gray-600">
          <span>{{ row.startDate }}</span>
          <span class="text-gray-400">{{ row.endDate }}</span>
        </div>
      </ng-template>

      <!-- Custom cell: Actions -->
      <ng-template cellDef="actions" let-row>
        <button
          type="button"
          class="flex size-8 items-center justify-center rounded-full text-primary transition hover:bg-gray-100"
          aria-label="View trip details"
        >
          <app-icon name="eye" size="sm" />
        </button>
      </ng-template>
    </app-data-table>
  </div>

  <!-- ═══════ Pagination ═══════ -->
  <div class="px-4 pb-4 md:px-6 md:pb-6">
    <app-pagination
      [currentPage]="currentPage()"
      [totalItems]="filteredTrips().length"
      [pageSize]="pageSize()"
      (pageChange)="currentPage.set($event)"
    />
  </div>
</div>